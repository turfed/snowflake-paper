# userstats-bridge-transport-multi.csv,
# userstats-bridge-combined-multi.csv, and
# bandwidth-multi.csv are generated by the scripts at
# https://gitlab.torproject.org/dcf/snowflake-graphs

COUNTRIES = cn ir ru tm
COUNTRY_GRAPHS = $(addprefix users-,$(addsuffix .pdf,$(COUNTRIES)))

all: \
	users-global.pdf \
	$(COUNTRY_GRAPHS)
.PHONY: all

users-global.tmp.pdf: .EXTRA_PREREQS = users-global.r ../common.r
users-global.tmp.pdf: userstats-bridge-transport-multi.csv bandwidth-multi.csv
	Rscript users-global.r $^ "$@"

$(COUNTRY_GRAPHS:.pdf=.tmp.pdf): .EXTRA_PREREQS = users-country.r ../common.r
$(COUNTRY_GRAPHS:.pdf=.tmp.pdf)&: userstats-bridge-combined-multi.csv
	Rscript users-country.r "$<"

# Embed fonts.
.INTERMEDIATE: users-global.tmp.pdf $(COUNTRY_GRAPHS:.pdf=.tmp.pdf)
%.pdf: %.tmp.pdf
	gs -q -dSAFER -dNOPAUSE -dBATCH -sDEVICE=pdfwrite -sOutputFile="$@" -dCompatibilityLevel=1.5 -dEmbedAllFonts=true -c '<</NeverEmbed []>> setdistillerparams' -f "$<"

.DELETE_ON_ERROR:
