# proxy-type.csv and proxy-nat-type.csv are generated by the scripts at
# https://gitlab.torproject.org/dcf/snowflake-graphs

all: \
	proxy-type.pdf \
	proxy-nat-type.pdf
.PHONY: all

*.pdf *.tmp.pdf *.svg *.tmp.png: .EXTRA_PREREQS = proxy-type.r ../common.r
proxy-type.tmp.pdf proxy-type.svg proxy-type.png: proxy-type.csv
	Rscript proxy-type.r "$<" "$@"

proxy-nat-type.tmp.pdf proxy-nat-type.svg proxy-nat-type.tmp.png: proxy-nat-type.csv
	Rscript proxy-nat-type.r "$<" "$@"

.INTERMEDIATE: proxy-type.tmp.pdf proxy-nat-type.tmp.pdf proxy-type.tmp.png proxy-nat-type.tmp.png
%.pdf: %.tmp.pdf
# Embed fonts.
	gs -q -dSAFER -dNOPAUSE -dBATCH -sDEVICE=pdfwrite -sOutputFile="$@" -dCompatibilityLevel=1.5 -dEmbedAllFonts=true -c '<</NeverEmbed []>> setdistillerparams' -f "$<"
%.png: %.tmp.png
	zopflipng -y -m "$<" "$@"

.DELETE_ON_ERROR:
